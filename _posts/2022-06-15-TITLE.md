---
title: Setting up WireGardVPN at home
date: 2022-06-15
categories: [VPN, Wireguard]
tags: [TAG]     # TAG names should always be lowercase
---

## How to set-up WireGardVPN on debian, ubuntu?

In this tutorial the folowing software will be used, requred:
* curl
* docker, docker compose
* pivpn
* duck-dns docker image

Running vpn at home requres three general components:
* VPN server, this is a PC that is running VPN. In our case wireguard 
* Dynamc DNS service, is a service that can connect forward internet trafic from a domain to an IP address. This is requred since the vpn clents will use this domain as the url to connect to the VPN. The Dynamic DNS then will forward trafic from this url to the IP address that in this case is our PC runing wireguard. Important point to note here is that the IP of a home PC is changing and onse the ip changes the Dynamic DNS will need to be informed of the new IP address. 
* Port forwarding, the home router needs to forward the VPN trafic to the wireguard server PC. This process is called port forwarding.

## Setup wireguard on debian / ubuntu

### Install curl
As first step you need to install curl, that is in case it is not already installed.   
```sh
sudo apt install curl
```
Reference: https://www.cyberciti.biz/faq/how-to-install-curl-command-on-a-ubuntu-linux/

### Install piVPN
Second step, piVPN needs to be installed. PiVPN is an easy way to set up wireguard. After running the following command, step by step instaliation proces is started that will guide you thew the install process. PiVPN also offers OpenVpn so make sure you pick the correct vpn during this process. Also select custom-dns from the dns list as this tutorial shows hot to use Duck-dns
```sh
curl -L https://install.pivpn.io | bash
```
![S](/_site/assets/img/2022-06-15-TITLE/dns_provider.png)
![S](/_site/assets/img/2022-06-15-TITLE/installation_mode.png)

Reference: https://www.pivpn.io/

## Set up Dynamic DNS
To for dynamic dns DuckDNS will be used. This requres setting up account on DuckDNS and getting a domain. After you have a domain you need to periodicaly update the IP address assosiated with this domain.

### Get a domain on DuckDNS
Domains on duck dns are free but are limited per account. 
<!-- TODO register an account on duck dns -->
<!-- TODO get domain on duck dns -->

### Refresh Dynamic DNS IP address

This requres periodicaly calling the DUCK DNS API from the PC that runs wireguard. To do this a script can be created, but there is also already existing dockerimage specially desgned for this task that can be used. In this tutorial I'll use docker-compose to run the image as I find it personaly more convinient. 

#### Install docker

```sh
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```
Reference: https://docs.docker.com/engine/install/ubuntu/

#### Install docker-compose

```sh 
sudo apt-get install docker-compose-plugin
```

#### Create docker-compose file

On the pc running wireguard, create a docker compose file 
docker-compose.yml with the folowing content:
```sh
version: "2.1"
services:
  duckdns:
    image: ghcr.io/linuxserver/duckdns
    container_name: duckdns
    environment:
      - PUID=1000 #optional
      - PGID=1000 #optional
      - TZ=Europe/XXXXX
      - SUBDOMAINS=oXXX-XXX
      - TOKEN=5187bc8b-XXXX-XXXX-XXXX-XXXXXXXXXXXX
      - LOG_FILE=false #optional
    restart: unless-stopped
```

#### Run docker-compose

Run the following command on the same level of the docker-compose.yml file:
```sh
docker-compose up
```
or to run in background:
```sh
docker-compose up -d
```
Reference: https://docs.docker.com/compose/gettingstarted/

## Port forwarding

Port forwardin is the last step. The concept here is that wireguard useds by defould 51820 port. Most probably your router is blocking this port so you have to redirect any trafic comming to port 51820 to the IP address of PC running wireguard. Port forwarding is a unique process for every router manufacure and also perhaps every router, thats why you will need to reasearch for your specific model. Important thing here is to assign a static IP address to the pc running wireguard. This is inportant since In case the IP chages the pord forwarding might not work any more.

## Test

Get keys from for the wireguard clients, set them up and test the process. 
<!-- tutorial on getting keys -->

https://jamstackthemes.dev/demo/theme/jekyll-theme-chirpy/